<!doctype html>
<html lang="en">
<head>
    <title>Code coverage report for src/telemetry/telemetry.ts</title>
    <meta charset="utf-8" />
    <link rel="stylesheet" href="..\..\prettify.css" />
    <link rel="stylesheet" href="..\..\base.css" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style type='text/css'>
        .coverage-summary .sorter {
            background-image: url(..\..\sort-arrow-sprite.png);
        }
    </style>
</head>
<body>
<div class='wrapper'>
  <div class='pad1'>
    <h1>
      <a href="..\..\index.html">All files</a> / <a href="index.html">src/telemetry</a> telemetry.ts
    </h1>
    <div class='clearfix'>
    </div>
  </div>
  <div class='status-line low'></div>
<pre><table class="coverage">
<tr><td class="line-count quiet">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124</td><td class="line-coverage quiet"><span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2x</span>
<span class="cline-any cline-yes">2x</span>
<span class="cline-any cline-yes">2x</span>
<span class="cline-any cline-yes">2x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2x</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2x</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2x</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2x</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2x</span>
<span class="cline-any cline-yes">4x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2x</span>
<span class="cline-any cline-neutral">&nbsp;</span></td><td class="text"><pre class="prettyprint lang-js">/* eslint-disable max-len */
import {
  ReactPlugin,
  withAITracking
} from '@microsoft/applicationinsights-react-js';
import {
  ApplicationInsights,
  SeverityLevel
} from '@microsoft/applicationinsights-web';
import { ComponentType } from 'react';
&nbsp;
import '../app/utils/string-operations';
import { version } from '../../package.json';
import { validateExternalLink } from '../app/utils/external-link-validation';
import { sanitizeQueryUrl } from '../app/utils/query-url-sanitization';
import { IQuery } from '../types/query-runner';
import {
  BUTTON_CLICK_EVENT,
  LINK_CLICK_EVENT,
  TAB_CLICK_EVENT
} from './event-types';
import {
  addCommonTelemetryItemProperties,
  filterRemoteDependencyData,
  filterTelemetryTypes,
  sanitizeStackTrace,
  sanitizeTelemetryItemUriProperty
} from './filters';
import ITelemetry from './ITelemetry';
&nbsp;
class Telemetry implements ITelemetry {
  private appInsights: ApplicationInsights;
  private config: any;
  private reactPlugin: any;
&nbsp;
  constructor() {
    this.reactPlugin = new ReactPlugin();
&nbsp;
    this.config = {
      instrumentationKey: this.getInstrumentationKey(),
      disableExceptionTracking: false, // Enables autocollection of uncaught exceptions. Used with `sanitizeStackTrace` telemetry initializer to remove any data that might be PII.
      disableAjaxTracking: true,
      disableFetchTracking: false, // Enables capturing of telemetry data for outgoing requests. Used with `filterRemoteDependencyData` telemetry initializer to sanitize captured data to prevent inadvertent capture of PII.
      disableTelemetry: this.getInstrumentationKey() ? false : <span class="branch-1 cbranch-no" title="branch not covered" >true,</span>
      extensions: [this.reactPlugin]
    };
&nbsp;
    this.appInsights = new ApplicationInsights({
      config: this.config
    });
  }
&nbsp;
<span class="fstat-no" title="function not covered" >  public initialize() {</span>
<span class="cstat-no" title="statement not covered" >    this.appInsights.loadAppInsights();</span>
<span class="cstat-no" title="statement not covered" >    this.appInsights.trackPageView();</span>
<span class="cstat-no" title="statement not covered" >    this.appInsights.addTelemetryInitializer(filterTelemetryTypes);</span>
<span class="cstat-no" title="statement not covered" >    this.appInsights.addTelemetryInitializer(filterRemoteDependencyData);</span>
<span class="cstat-no" title="statement not covered" >    this.appInsights.addTelemetryInitializer(sanitizeStackTrace);</span>
<span class="cstat-no" title="statement not covered" >    this.appInsights.addTelemetryInitializer(sanitizeTelemetryItemUriProperty);</span>
<span class="cstat-no" title="statement not covered" >    this.appInsights.addTelemetryInitializer(addCommonTelemetryItemProperties);</span>
<span class="cstat-no" title="statement not covered" >    this.appInsights.context.application.ver = version;</span>
  }
&nbsp;
<span class="fstat-no" title="function not covered" >  public trackEvent(</span>name: string, properties: {}) {
<span class="cstat-no" title="statement not covered" >    this.appInsights.trackEvent({ name, properties });</span>
  }
&nbsp;
<span class="fstat-no" title="function not covered" >  public trackException(</span>
    error: Error,
    severityLevel: SeverityLevel,
    properties: {}
  ) {
<span class="cstat-no" title="statement not covered" >    this.appInsights.trackException({ error, severityLevel, properties });</span>
  }
&nbsp;
<span class="fstat-no" title="function not covered" >  public trackReactComponent(</span>
    ComponentToTrack: ComponentType,
    componentName?: string
  ): ComponentType {
<span class="cstat-no" title="statement not covered" >    return withAITracking(this.reactPlugin, ComponentToTrack, componentName);</span>
  }
&nbsp;
<span class="fstat-no" title="function not covered" >  public trackTabClickEvent(</span>tabKey: string, sampleQuery?: IQuery) {
    const componentName = <span class="cstat-no" title="statement not covered" >tabKey.replace('-', ' ').toSentenceCase();</span>
    const properties: { [key: string]: any } = <span class="cstat-no" title="statement not covered" >{</span>
      ComponentName: `${componentName} tab`
    };
<span class="cstat-no" title="statement not covered" >    if (sampleQuery) {</span>
      const sanitizedUrl = <span class="cstat-no" title="statement not covered" >sanitizeQueryUrl(sampleQuery.sampleUrl);</span>
<span class="cstat-no" title="statement not covered" >      properties.QuerySignature = `${sampleQuery.selectedVerb} ${sanitizedUrl}`;</span>
    }
<span class="cstat-no" title="statement not covered" >    telemetry.trackEvent(TAB_CLICK_EVENT, properties);</span>
  }
&nbsp;
<span class="fstat-no" title="function not covered" >  public trackLinkClickEvent(</span>url: string, componentName: string) {
<span class="cstat-no" title="statement not covered" >    telemetry.trackEvent(LINK_CLICK_EVENT, { ComponentName: componentName });</span>
<span class="cstat-no" title="statement not covered" >    validateExternalLink(url, componentName);</span>
  }
&nbsp;
<span class="fstat-no" title="function not covered" >  public trackCopyButtonClickEvent(</span>
    componentName: string,
    sampleQuery?: IQuery,
    properties?: { [key: string]: string }
  ) {
<span class="cstat-no" title="statement not covered" >    properties = properties || {};</span>
<span class="cstat-no" title="statement not covered" >    properties.ComponentName = componentName;</span>
<span class="cstat-no" title="statement not covered" >    if (sampleQuery) {</span>
      const sanitizedUrl = <span class="cstat-no" title="statement not covered" >sanitizeQueryUrl(sampleQuery.sampleUrl);</span>
<span class="cstat-no" title="statement not covered" >      properties.QuerySignature = `${sampleQuery.selectedVerb} ${sanitizedUrl}`;</span>
    }
<span class="cstat-no" title="statement not covered" >    telemetry.trackEvent(BUTTON_CLICK_EVENT, properties);</span>
  }
&nbsp;
  private getInstrumentationKey() {
    return (
      (window as any).InstrumentationKey ||
      process.env.REACT_APP_INSTRUMENTATION_KEY ||
<span class="branch-2 cbranch-no" title="branch not covered" >      ''</span>
    );
  }
}
&nbsp;
export const telemetry = new Telemetry();
&nbsp;</pre></td></tr>
</table></pre>
<div class='push'></div><!-- for sticky footer -->
</div><!-- /wrapper -->
<div class='footer quiet pad2 space-top1 center small'>
  Code coverage
  generated by <a href="https://istanbul.js.org/" target="_blank">istanbul</a> at Wed Nov 24 2021 12:09:44 GMT+0300 (East Africa Time)
</div>
</div>
<script src="..\..\prettify.js"></script>
<script>
window.onload = function () {
        if (typeof prettyPrint === 'function') {
            prettyPrint();
        }
};
</script>
<script src="..\..\sorter.js"></script>
</body>
</html>
