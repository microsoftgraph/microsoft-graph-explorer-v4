<!doctype html>
<html lang="en">
<head>
    <title>Code coverage report for src/app/middleware/telemetryMiddleware.ts</title>
    <meta charset="utf-8" />
    <link rel="stylesheet" href="..\..\..\prettify.css" />
    <link rel="stylesheet" href="..\..\..\base.css" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style type='text/css'>
        .coverage-summary .sorter {
            background-image: url(..\..\..\sort-arrow-sprite.png);
        }
    </style>
</head>
<body>
<div class='wrapper'>
  <div class='pad1'>
    <h1>
      <a href="..\..\..\index.html">All files</a> / <a href="index.html">src/app/middleware</a> telemetryMiddleware.ts
    </h1>
    <div class='clearfix'>
    </div>
  </div>
  <div class='status-line low'></div>
<pre><table class="coverage">
<tr><td class="line-count quiet">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91</td><td class="line-coverage quiet"><span class="cline-any cline-yes">2x</span>
<span class="cline-any cline-yes">2x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2x</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2x</span>
<span class="cline-any cline-neutral">&nbsp;</span></td><td class="text"><pre class="prettyprint lang-js">import { SeverityLevel } from '@microsoft/applicationinsights-web';
import { componentNames, errorTypes, telemetry } from '../../telemetry';
import { IAction } from '../../types/action';
import { IQuery } from '../../types/query-runner';
import { IRootState } from '../../types/root';
import {
  FETCH_ADAPTIVE_CARD_ERROR,
  FETCH_SCOPES_ERROR,
  GET_SNIPPET_ERROR,
  SAMPLES_FETCH_ERROR
} from '../services/redux-constants';
import { sanitizeQueryUrl } from '../utils/query-url-sanitization';
&nbsp;
const telemetryMiddleware =
  (store: any) =&gt; (next: any) =&gt; <span class="fstat-no" title="function not covered" >async (</span>action: IAction) =&gt; {
    const <span class="cstat-no" title="statement not covered" >state: IRootState = store.getState();</span>
<span class="cstat-no" title="statement not covered" >    switch (action.type) {</span>
      case GET_SNIPPET_ERROR: {
<span class="cstat-no" title="statement not covered" >        trackException(</span>
          componentNames.GET_SNIPPET_ACTION,
          state.sampleQuery,
          action.response.error,
          {
            Language: action.response.language
          }
        );
<span class="cstat-no" title="statement not covered" >        break;</span>
      }
      case FETCH_SCOPES_ERROR: {
<span class="cstat-no" title="statement not covered" >        trackException(</span>
          componentNames.FETCH_PERMISSIONS_ACTION,
          state.sampleQuery,
          action.response.error,
          {
            HasRequestUrl: action.response.hasUrl
          }
        );
<span class="cstat-no" title="statement not covered" >        break;</span>
      }
      case SAMPLES_FETCH_ERROR: {
<span class="cstat-no" title="statement not covered" >        trackException(</span>
          componentNames.FETCH_SAMPLES_ACTION,
          state.sampleQuery,
          action.response,
          {}
        );
<span class="cstat-no" title="statement not covered" >        break;</span>
      }
      case FETCH_ADAPTIVE_CARD_ERROR: {
<span class="cstat-no" title="statement not covered" >        trackException(</span>
          componentNames.GET_ADAPTIVE_CARD_ACTION,
          state.sampleQuery,
          action.response,
          {}
        );
<span class="cstat-no" title="statement not covered" >        break;</span>
      }
    }
<span class="cstat-no" title="statement not covered" >    return next(action);</span>
  };
&nbsp;
function <span class="fstat-no" title="function not covered" >trackException(</span>
  componentName: string,
  sampleQuery: IQuery,
  error: any,
  properties: { [key: string]: any }
): void {
  let errorType: string = <span class="cstat-no" title="statement not covered" >errorTypes.OPERATIONAL_ERROR;</span>
  let errorMessage: string = <span class="cstat-no" title="statement not covered" >JSON.stringify(error);</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >  if (error instanceof Response) {</span>
<span class="cstat-no" title="statement not covered" >    errorType = errorTypes.NETWORK_ERROR;</span>
<span class="cstat-no" title="statement not covered" >    errorMessage = `ApiError: ${error.status}`;</span>
  }
&nbsp;
<span class="cstat-no" title="statement not covered" >  if (sampleQuery.sampleUrl) {</span>
    const sanitizedUrl = <span class="cstat-no" title="statement not covered" >sanitizeQueryUrl(sampleQuery.sampleUrl);</span>
<span class="cstat-no" title="statement not covered" >    properties.QuerySignature = `${sampleQuery.selectedVerb} ${sanitizedUrl}`;</span>
  }
&nbsp;
<span class="cstat-no" title="statement not covered" >  properties.Message = errorMessage;</span>
<span class="cstat-no" title="statement not covered" >  properties.ComponentName = componentName;</span>
<span class="cstat-no" title="statement not covered" >  telemetry.trackException(</span>
    new Error(errorType),
    SeverityLevel.Error,
    properties
  );
}
&nbsp;
export default telemetryMiddleware;
&nbsp;</pre></td></tr>
</table></pre>
<div class='push'></div><!-- for sticky footer -->
</div><!-- /wrapper -->
<div class='footer quiet pad2 space-top1 center small'>
  Code coverage
  generated by <a href="https://istanbul.js.org/" target="_blank">istanbul</a> at Wed Nov 24 2021 12:09:44 GMT+0300 (East Africa Time)
</div>
</div>
<script src="..\..\..\prettify.js"></script>
<script>
window.onload = function () {
        if (typeof prettyPrint === 'function') {
            prettyPrint();
        }
};
</script>
<script src="..\..\..\sorter.js"></script>
</body>
</html>
